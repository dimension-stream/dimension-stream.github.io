"use strict";(self.webpackChunkdimension_stream_github_io=self.webpackChunkdimension_stream_github_io||[]).push([[830],{6830:(n,e,t)=>{t.r(e),t.d(e,{init:()=>h});var o=t(3466),a=t(9477),r=t(9365),i=t(7885),l=function(n,e,t,o){return new(t||(t=Promise))((function(a,r){function i(n){try{c(o.next(n))}catch(n){r(n)}}function l(n){try{c(o.throw(n))}catch(n){r(n)}}function c(n){var e;n.done?a(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(i,l)}c((o=o.apply(n,e||[])).next())}))},c=function(n,e){var t,o,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(i=0)),i;)try{if(t=1,o&&(a=2&l[0]?o.return:l[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,l[1])).done)return a;switch(o=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(n,i)}catch(n){l=[6,n],o=0}finally{t=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},s=t(9530);console.log("old_webpage");var u,v,d,m,f={uniforms:{u_data:{value:-1},u_inv_modelview_pos:{value:-1}},vertexShader:'\n        uniform vec3 u_inv_modelview_pos;\n        out vec3 v_rd;\n        void main() {\n            // Transform rd to "aabb" space.\n            v_rd = position.xyz - u_inv_modelview_pos;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }',fragmentShader:'\n        precision highp float;\n        precision highp sampler3D;\n        uniform vec3 u_inv_modelview_pos;\n        uniform sampler3D u_data;\n        in vec3 v_rd;\n\n        float min_component(in vec3 v) {\n            return min(min(v.x, v.y), v.z);\n        }\n\n        float max_component(in vec3  v) {\n            return max(max(v.x, v.y), v.z);\n        }\n\n        // Intersect a ray with aabb where aabb.mix.xyz = -1, and aabb.max.xyz = 1.\n        // returns vec2(min_t, max_t).\n        vec2 boxIntersection(in vec3 ro, in vec3 rd) {\n            vec3 m = 1.0/rd;\n            vec3 n = ro*m;\n            vec3 t0 = -m - n;\n            vec3 t1 = m - n;\n            // isect if mint <= maxt;\n            return vec2(max_component(min(t0,t1)), min_component(max(t0,t1)));\n        }\n\n        float hash(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }\n        const float E = 2.7182818284;\n        void main() {\n            // Transform rays to "aabb" space.\n            vec3 rd = normalize(v_rd);\n            vec3 ro = u_inv_modelview_pos;\n            vec2 ti = boxIntersection(ro, rd);\n\n            vec3 H = vec3(0.0);\n            float V_i = 0.0;\n            const float dt = 2.0/512.0;\n            // for(float t = max(ti.x, 0.0) + 1.0*dt*(2.0*hash(rd.xy)-1.0); (t < ti.y); t+=dt)\n            for(float t = max(ti.x, 0.0); (t < ti.y); t+=dt)\n            {\n                vec3 pos = ro + t*rd;\n                // pos.xyz is in range (-1, 1).\n                vec3 uv = 0.5*pos+0.5;\n                vec4 val = texture(u_data, uv);\n                val.a = 256.0*(exp(val.a)-1.0)/(E-1.0); // uint8(255*log((e-1)*clamp(v,0,S)/S + 1)), S=256\n                // val.a = 256.0*val.a; // uint8(255*clamp(v,0,S)/S), S=256\n                // float v = val.a; // float\n                if(val.a > 1.0)\n                {\n                    float v = val.a*dt;\n                    H += exp(-V_i) * (1.0 - exp(-v)) * val.rgb;\n                    V_i += v;\n                }\n            }\n            // V_i = V_i*smoothstep(0.1, 1.0, V_i);\n            gl_FragColor.rgb = H + exp(-V_i) * vec3(0.0);\n            gl_FragColor.a = 1.0;\n        }'};function p(){var n=document.getElementById("volume-canvas");return[n.clientWidth,n.clientHeight]}function _(){m.begin(),u.render(v,d),requestAnimationFrame(_),m.end()}function h(n){var e=this;(m=new o).showPanel(0),document.body.appendChild(m.dom);var t=document.getElementById("volume-canvas");u=new a.CP7({antialias:!1,canvas:t});var h=p();u.setSize(h[0],h[1]),window.addEventListener("resize",x),v=new a.xsS,(d=new a.cPb(60,h[0]/h[1],.1,50)).position.set(-2.5,2.5,2.5),d.lookAt(0,0,0),new r.z(d,u.domElement),v.add(d);var w=document.getElementById("progress"),b=document.getElementById("progress_bar"),y=document.getElementById("progress_text");(new a.hH6).setResponseType("arraybuffer").load("/3d_models/"+n+".tar.gz",(function(n){return l(e,void 0,void 0,(function(){var e,t,o,r,l,u,d,m,p,h,x,b;return c(this,(function(c){switch(c.label){case 0:return e=i.ec(new Uint8Array(n)),[4,s(e.buffer).then((function(n){console.log(n)}),(function(n){console.log(n)}),(function(n){if(console.log(n),"grid.bin"===n.name)t=n.buffer;else if("grid.json"===n.name){var e=n.readAsJSON();o=e.GRID_RES,r=e.GRID_HALF_SIDE;var i=e.FORMAT;l="UCHAR"==i?a.ywz:a.VzW}}))];case 1:return c.sent(),u=new Uint8Array(t),(d=new a.JUT(u,o[0],o[1],o[2])).format=a.wk1,d.type=l,d.magFilter=a.wem,d.minFilter=a.wem,d.needsUpdate=!0,d.generateMipmaps=!1,m=f,(p=a.rDY.clone(m.uniforms)).u_data.value=d,p.u_inv_modelview_pos.value=new a.Pa4,h=new a.jyz({uniforms:p,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,side:a._Li}),x=new a.DvJ(2,2,2),(b=new a.Kj0(x,h)).rotation.set(Math.PI/2,Math.PI,Math.PI),b.scale.set(r[0],r[1],r[2]),b.onBeforeRender=function(n,e,t,o,a,r){a.uniforms.u_inv_modelview_pos.value.setFromMatrixColumn(t.matrixWorldInverse.clone().multiply(b.matrixWorld).invert(),3)},v.add(b),w.style.display="none",_(),[2]}}))}))}),(function(n){n.loaded===n.total?y.innerHTML="Unpacking...":y.innerHTML=Math.round(n.loaded/n.total*100)+"%",b.value=n.loaded/n.total*100}),(function(n){console.log("Error: "+n)}))}function x(){var n=p();d.aspect=n[0]/n[1],d.updateProjectionMatrix(),u.setSize(n[0],n[1])}}}]);