/*! For license information please see 142.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkdimension_stream_github_io=self.webpackChunkdimension_stream_github_io||[]).push([[142],{2142:(n,e,t)=>{t.r(e),t.d(e,{init:()=>G,toggleHeadTracking:()=>Y});var a,i,o=t(9477),r=t(9365),d=t(7885),s=t(8761),c=(new URLSearchParams(window.location.search).get("id"),78/180*Math.PI),l={camYBias:0,camZBias:0,eyeSizeBias:0};s.r.onGUIConstructed=function(n){var e=n.addFolder("VirtualHole");e.add(l,"eyeSizeBias",-10,10).step(.01),e.add(l,"camYBias",-10,10).step(.01),e.add(l,"camZBias",-10,10).step(.01),e.open()};var u=24.2;s.r.onCameraChanged=function(n){var e=n.video.videoWidth,t=n.video.videoHeight;Math.atan(Math.tan(c/2)*e/Math.sqrt(t*t+e*e)),Math.atan(Math.tan(c/2)*t/Math.sqrt(t*t+e*e)),a=[e,t],i=.5*Math.sqrt(a[0]*a[0]+a[1]*a[1])*Math.tan(.5*Math.PI-.5*c)};var v=[263,362],f=[33,133],m=6;function h(n,e){return[n[0]-e[0],n[1]-e[1],n[2]-e[2]]}function p(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function g(n){var e=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return n[0]/=e,n[1]/=e,n[2]/=e,n}var w=!1,y=[[0,0,0],[0,0,0],[0,0,0]],_=[[0,0,0],[0,0,0],[0,0,0]];var x,b,M,C,S,k=t(2694),I=t(4376),z=function(n,e,t,a){return new(t||(t=Promise))((function(i,o){function r(n){try{s(a.next(n))}catch(n){o(n)}}function d(n){try{s(a.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(r,d)}s((a=a.apply(n,e||[])).next())}))},F=function(n,e){var t,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function d(d){return function(s){return function(d){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,d[0]&&(r=0)),r;)try{if(t=1,a&&(i=2&d[0]?a.return:d[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,d[1])).done)return i;switch(a=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,a=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==d[0]&&2!==d[0])){r=0;continue}if(3===d[0]&&(!i||d[1]>i[0]&&d[1]<i[3])){r.label=d[1];break}if(6===d[0]&&r.label<i[1]){r.label=i[1],i=d;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(d);break}i[2]&&r.ops.pop(),r.trys.pop();continue}d=e.call(n,r)}catch(n){d=[6,n],a=0}finally{t=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([d,s])}}},P=t(9530),B=.621,T=.341,R={Translation:{X:0,Y:0,Z:0},Rotation:{X:0,Y:0,Z:0},Scale:.05,"Use headtracking":!1};function H(n,e){var t=n.addFolder("Viewer");if(e){var a=t.addFolder("Transforms"),i=a.addFolder("Translation");i.add(R.Translation,"X",-.1,.1).step(.001),i.add(R.Translation,"Y",-.1,.1).step(.001),i.add(R.Translation,"Z",-.1,.1).step(.001);var o=a.addFolder("Rotation");o.add(R.Rotation,"X",0,2*Math.PI).step(.001),o.add(R.Rotation,"Y",0,2*Math.PI).step(.001),o.add(R.Rotation,"Z",0,2*Math.PI).step(.001),a.add(R,"Scale",.01,.1).step(.001)}t.add(R,"Use headtracking").onChange((function(n){return Y(n)})),t.open()}var U,E,V=new I.XS({width:300});function A(){E===A?(console.log("normal rendering"),x.render(b,M)):console.log("skipped rendering")}function D(){C.rotation.set(R.Rotation.X+Math.PI/2,R.Rotation.Z+Math.PI,R.Rotation.Y+Math.PI),C.scale.set(R.Scale*S[0],R.Scale*S[1],R.Scale*S[2]),C.position.set(R.Translation.X,R.Translation.Y,R.Translation.Z),k.Dd(!1).then((function(n){if(null!=n&&n.length>0){var e=function(n,e,t,a){void 0===a&&(a=!0),a&&(n=function(n){var e=1/4.125;if(w)return w=!1,_[0]=n,_[1]=n,y[0]=n,y[1]=n,n;var t=[(-.25*_[0][0]+.375*_[1][0]+n[0]+2*y[0][0]+y[1][0])*e,(-.25*_[0][1]+.375*_[1][1]+n[1]+2*y[0][1]+y[1][1])*e,(-.25*_[0][2]+.375*_[1][2]+n[2]+2*y[0][2]+y[1][2])*e];return _[1]=_[0],_[0]=t,y[1]=y[0],y[0]=n,t}(n));var i,o,r,d,s,c,l,u,v,f,m,x,b,M,C,S,k=-e/2,I=-t/2;return i=[k,I,0],o=[k+e,I,0],r=[k,I+t,0],d=[n[0],n[1],n[2]],s=.1,c=g(h(o,i)),l=g(h(r,i)),u=g(function(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}(c,l)),v=h(i,d),f=h(o,d),m=h(r,d),x=-p(v,u),b=p(c,v)*s/x,M=p(c,f)*s/x,C=p(l,v)*s/x,S=p(l,m)*s/x,[[.2/(M-b),0,0,0,0,.2/(S-C),0,0,(M+b)/(M-b),(S+C)/(S-C),-10.1/9.9,-1,0,0,-2/9.9,0],[c[0],l[0],u[0],0,c[1],l[1],u[1],0,c[2],l[2],u[2],0,d[0],d[1],d[2],1]]}(function(n){var e,t,o=n[0].keypoints[v[0]],r=n[0].keypoints[v[1]],d=n[0].keypoints[f[0]],s=n[0].keypoints[f[1]],c=function(n,e){var t=n.x-e.x,a=n.y-e.y;return Math.sqrt(t*t+a*a)},h=c(o,r),p=c(d,s),g=(e=Math.max(h,p),(u+l.eyeSizeBias)*i/e-l.camZBias),w=(t=[n[0].keypoints[m].x,n[0].keypoints[m].y],[Math.atan2(a[0]/2-t[0],i),Math.atan2(a[1]/2-t[1],i)]);return[Math.tan(w[0])*g,Math.tan(w[1])*g+l.camYBias,g+l.camZBias].map((function(n){return n/1e3}))}(n),B,T);(new o.yGw).fromArray(e[1]).decompose(M.position,M.quaternion,M.scale),M.projectionMatrix.fromArray(e[0]),M.projectionMatrixInverse.copy(M.projectionMatrix).invert(),M.updateMatrixWorld(),x.render(b,M)}requestAnimationFrame(E)}))}V.domElement.id="gui",H(V,!1),s.r.onGUIConstructed=(U=s.r.onGUIConstructed,function(n){U(n),V.destroy(),H(n,!0),n.__folders.Backend.hide(),n.__folders.Model.hide(),n.__folders.Camera.close(),n.__folders.VirtualHole.close()});var q=function(){return z(this,void 0,void 0,(function(){var n=this;return F(this,(function(e){return this.initialized||this.pending?[2,this.initialized]:(this.pending=!0,[2,s.S().then((function(){return n.pending=!1,n.initialized=!0,n.initialized}))])}))}))}.bind({initialized:!1,pending:!1});function Y(n){return z(this,void 0,void 0,(function(){return F(this,(function(e){return n?q().then((function(n){n&&(E=D,requestAnimationFrame(E))})):(E=A,requestAnimationFrame(E)),[2]}))}))}var Z={uniforms:{u_data:{value:-1},u_inv_modelview_pos:{value:-1}},vertexShader:'\n        uniform vec3 u_inv_modelview_pos;\n        out vec3 v_rd;\n        void main() {\n            // Transform rd to "aabb" space.\n            v_rd = position.xyz - u_inv_modelview_pos;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }',fragmentShader:'\n        precision highp float;\n        precision highp sampler3D;\n        uniform vec3 u_inv_modelview_pos;\n        uniform sampler3D u_data;\n        in vec3 v_rd;\n\n        float min_component(in vec3 v) {\n            return min(min(v.x, v.y), v.z);\n        }\n\n        float max_component(in vec3  v) {\n            return max(max(v.x, v.y), v.z);\n        }\n\n        // Intersect a ray with aabb where aabb.mix.xyz = -1, and aabb.max.xyz = 1.\n        // returns vec2(min_t, max_t).\n        vec2 boxIntersection(in vec3 ro, in vec3 rd) {\n            vec3 m = 1.0/rd;\n            vec3 n = ro*m;\n            vec3 t0 = -m - n;\n            vec3 t1 = m - n;\n            // isect if mint <= maxt;\n            return vec2(max_component(min(t0,t1)), min_component(max(t0,t1)));\n        }\n\n        float hash(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }\n        const float E = 2.7182818284;\n        void main() {\n            // Transform rays to "aabb" space.\n            vec3 rd = normalize(v_rd);\n            vec3 ro = u_inv_modelview_pos;\n            vec2 ti = boxIntersection(ro, rd);\n\n            vec3 H = vec3(0.0);\n            float V_i = 0.0;\n            const float dt = 2.0/512.0;\n            // for(float t = max(ti.x, 0.0) + 1.0*dt*(2.0*hash(rd.xy)-1.0); (t < ti.y); t+=dt)\n            for(float t = max(ti.x, 0.0); (t < ti.y); t+=dt)\n            {\n                vec3 pos = ro + t*rd;\n                // pos.xyz is in range (-1, 1).\n                vec3 uv = 0.5*pos+0.5;\n                vec4 val = texture(u_data, uv);\n                val.a = 256.0*(exp(val.a)-1.0)/(E-1.0); // uint8(255*log((e-1)*clamp(v,0,S)/S + 1)), S=256\n                // val.a = 256.0*val.a; // uint8(255*clamp(v,0,S)/S), S=256\n                // float v = val.a; // float\n                if(val.a > 1.0)\n                {\n                    float v = val.a*dt;\n                    H += exp(-V_i) * (1.0 - exp(-v)) * val.rgb;\n                    V_i += v;\n                }\n            }\n            // V_i = V_i*smoothstep(0.1, 1.0, V_i);\n            gl_FragColor.rgb = H + exp(-V_i) * vec3(0.0);\n            gl_FragColor.a = 1.0;\n        }'};function j(){var n=document.getElementById("volume-canvas");return[n.clientWidth,n.clientHeight]}function G(n){var e=this,t=document.getElementById("volume-canvas");x=new o.CP7({antialias:!1,canvas:t});var a=j();x.setSize(a[0],a[1]),window.addEventListener("resize",L),b=new o.xsS,(M=new o.cPb(60,a[0]/a[1],.1,50)).position.set(-2.5,2.5,2.5),M.lookAt(0,0,0),new r.z(M,x.domElement).addEventListener("change",A),b.add(M);var i=document.getElementById("progress"),s=document.getElementById("progress_bar"),c=document.getElementById("progress_text");(new o.hH6).setResponseType("arraybuffer").load("/3d_models/"+n+".tar.gz",(function(n){return z(e,void 0,void 0,(function(){var e,t,a,r,s,c,l,u,v,f;return F(this,(function(m){switch(m.label){case 0:return e=d.ec(new Uint8Array(n)),[4,P(e.buffer).then((function(n){console.log(n)}),(function(n){console.log(n)}),(function(n){if(console.log(n),"grid.bin"===n.name)t=n.buffer;else if("grid.json"===n.name){var e=n.readAsJSON();a=e.GRID_RES,S=e.GRID_HALF_SIDE;var i=e.FORMAT;r="UCHAR"==i?o.ywz:o.VzW}}))];case 1:return m.sent(),s=new Uint8Array(t),(c=new o.JUT(s,a[0],a[1],a[2])).format=o.wk1,c.type=r,c.magFilter=o.wem,c.minFilter=o.wem,c.needsUpdate=!0,c.generateMipmaps=!1,l=Z,(u=o.rDY.clone(l.uniforms)).u_data.value=c,u.u_inv_modelview_pos.value=new o.Pa4,v=new o.jyz({uniforms:u,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,side:o._Li}),f=new o.DvJ(2,2,2),(C=new o.Kj0(f,v)).rotation.set(Math.PI/2,Math.PI,Math.PI),C.scale.set(S[0],S[1],S[2]),C.onBeforeRender=function(n,e,t,a,i,o){i.uniforms.u_inv_modelview_pos.value.setFromMatrixColumn(t.matrixWorldInverse.clone().multiply(C.matrixWorld).invert(),3)},b.add(C),i.style.display="none",Y(R["Use headtracking"]),[2]}}))}))}),(function(n){n.loaded===n.total?c.innerHTML="Unpacking...":c.innerHTML=Math.round(n.loaded/n.total*100)+"%",s.value=n.loaded/n.total*100}),(function(n){console.log("Error: "+n)}))}function L(){var n=j();M.aspect=n[0]/n[1],M.updateProjectionMatrix(),x.setSize(n[0],n[1])}},2694:(n,e,t)=>{t.d(e,{Dd:()=>x,S1:()=>b,rr:()=>w}),t(9059);var a=t(3224),i=t(999),o=t(7155),r=t(3644),d=t(8734);const s=!1;let c,l,u,v,f,m=0,h=0,p=0;const g={stats:u,beginStats:function(){},endStats:function(){}},w={onChanged:function(n){},onCameraChanged:function(n){},onGUIConstructed:function(n){}};function y(){v=(performance||Date).now()}function _(){const n=(performance||Date).now();if(h+=n-v,++m,n-p>=1e3){const e=h/m;h=0,m=0,u.customFpsPanel.update(1e3/e,120),p=n}}async function x(n=!0){let e=null;return await async function(){if((o.ed.isTargetFPSChanged||o.ed.isSizeOptionChanged)&&(l=await a.V.setupCamera(o.ed.camera),o.ed.isTargetFPSChanged=!1,o.ed.isSizeOptionChanged=!1,w.onCameraChanged(l)),o.ed.isModelChanged||o.ed.isFlagChanged||o.ed.isBackendChanged){o.ed.isModelChanged=!0,window.cancelAnimationFrame(f),null!=c&&c.dispose(),(o.ed.isFlagChanged||o.ed.isBackendChanged)&&await(0,d.Qt)(o.ed.flags,o.ed.backend);try{c=await(0,o.cH)(o.ed.model)}catch(n){c=null,alert(n)}o.ed.isFlagChanged=!1,o.ed.isBackendChanged=!1,o.ed.isModelChanged=!1}}(),o.ed.isModelChanged||(e=async function(n){l.video.readyState<2&&await new Promise((n=>{l.video.onloadeddata=()=>{n()}}));let e=null;if(null!=c){s&&y();try{e=await c.estimateFaces(l.video,{flipHorizontal:!1}),w.onChanged(e)}catch(n){c.dispose(),c=null,alert(n)}s&&_()}return n&&(document.querySelector(".camera-canvas-wrapper").style.display="block",l.drawCtx(),e&&e.length>0&&!o.ed.isModelChanged&&l.drawResults(e,o.ed.modelConfig.triangulateMesh,o.ed.modelConfig.boundingBox)),e}(n)),e}async function b(){const n=new URLSearchParams(window.location.search),e=await(0,i.j)(n);w.onGUIConstructed(e),u=(0,r.t)(),g.stats=u,g.beginStats=y,g.endStats=_,l=await a.V.setupCamera(o.ed.camera),w.onCameraChanged(l),await(0,d.Qt)(o.ed.flags,o.ed.backend),c=await(0,o.cH)(),console.log("face detector created")}}}]);