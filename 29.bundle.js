/*! For license information please see 29.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkdimension_stream_github_io=self.webpackChunkdimension_stream_github_io||[]).push([[29],{6029:(n,e,t)=>{t.r(e),t.d(e,{init:()=>O,toggleHeadTracking:()=>Y});var a,r,o=t(9477),i=t(9365),c=t(7885),u=t(8761),s=(new URLSearchParams(window.location.search).get("id"),78/180*Math.PI),l={camYBias:0,camZBias:0,eyeSizeBias:0};u.r.onGUIConstructed=function(n){var e=n.addFolder("VirtualHole");e.add(l,"eyeSizeBias",-10,10).step(.01),e.add(l,"camYBias",-10,10).step(.01),e.add(l,"camZBias",-10,10).step(.01),e.open()};var d=24.2;u.r.onCameraChanged=function(n){var e=n.video.videoWidth,t=n.video.videoHeight;Math.atan(Math.tan(s/2)*e/Math.sqrt(t*t+e*e)),Math.atan(Math.tan(s/2)*t/Math.sqrt(t*t+e*e)),a=[e,t],r=.5*Math.sqrt(a[0]*a[0]+a[1]*a[1])*Math.tan(.5*Math.PI-.5*s)};var _=[263,362],f=[33,133],m=6;function v(n){var e,t,o=n[0].keypoints[_[0]],i=n[0].keypoints[_[1]],c=n[0].keypoints[f[0]],u=n[0].keypoints[f[1]],s=function(n,e){var t=n.x-e.x,a=n.y-e.y;return Math.sqrt(t*t+a*a)},v=s(o,i),h=s(c,u),x=(e=Math.max(v,h),(d+l.eyeSizeBias)*r/e-l.camZBias),p=(t=[n[0].keypoints[m].x,n[0].keypoints[m].y],[Math.atan2(a[0]/2-t[0],r),Math.atan2(a[1]/2-t[1],r)]);return[Math.tan(p[0])*x,Math.tan(p[1])*x+l.camYBias,x+l.camZBias].map((function(n){return n/1e3}))}function h(n,e){return[n[0]-e[0],n[1]-e[1],n[2]-e[2]]}function x(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function p(n){var e=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return n[0]/=e,n[1]/=e,n[2]/=e,n}var w=!1,g=[[0,0,0],[0,0,0],[0,0,0]],y=[[0,0,0],[0,0,0],[0,0,0]];var b,z,S,M=t(2694),k=t(4376),C=function(n,e,t,a){return new(t||(t=Promise))((function(r,o){function i(n){try{u(a.next(n))}catch(n){o(n)}}function c(n){try{u(a.throw(n))}catch(n){o(n)}}function u(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(i,c)}u((a=a.apply(n,e||[])).next())}))},H=function(n,e){var t,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(t=1,a&&(r=2&c[0]?a.return:c[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,c[1])).done)return r;switch(a=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,a=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(n,i)}catch(n){c=[6,n],a=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}},P=t(9530),T=!0;onkeydown=function(n){"p"===n.key&&((T=!T)?(b.maxPolarAngle=.51*Math.PI,b.minPolarAngle=.3*Math.PI):(b.maxPolarAngle=Math.PI,b.minPolarAngle=0))};var F=new o.cPb;F.matrixAutoUpdate=!1;var I=.621,A={Translation:{X:0,Y:0,Z:0},Rotation:{X:0,Y:0,Z:0},Scale:.05,"Use headtracking":!1};function B(){V===q&&requestAnimationFrame(V)}function D(n,e){var t=n.addFolder("Viewer");if(e){var a=t.addFolder("Transforms"),r=a.addFolder("Translation");r.add(A.Translation,"X",-.1,.1).step(.001).onChange(B),r.add(A.Translation,"Y",-.1,.1).step(.001).onChange(B),r.add(A.Translation,"Z",-.1,.1).step(.001).onChange(B),a.add(A,"Scale",.01,.1).step(.001).onChange(B)}t.add(A,"Use headtracking").onChange((function(n){return Y(n)})),t.open()}var U,R=new k.XS({width:300});R.domElement.id="gui",D(R,!0),u.r.onGUIConstructed=(U=u.r.onGUIConstructed,function(n){U(n),R.destroy(),D(n,!0),n.__folders.Backend.hide(),n.__folders.Model.hide(),n.__folders.Camera.close(),n.__folders.VirtualHole.close()});var V,E=new o.Tme;function W(){E.scale.set(A.Scale,A.Scale,A.Scale),E.position.set(A.Translation.X,A.Translation.Y,A.Translation.Z),E.updateMatrix()}function q(){W(),V===q?(console.log("normal rendering"),E.rotation.set(0,0,0),Z.render(G,X)):console.log("skipped rendering")}function j(){W(),M.Dd(!1).then((function(n){if(null!=n&&n.length>0){var e=K(),t=function(n,e,t,a){void 0===a&&(a=!0),a&&(n=function(n){var e=1/4.125;if(w)return w=!1,y[0]=n,y[1]=n,g[0]=n,g[1]=n,n;var t=[(-.25*y[0][0]+.375*y[1][0]+n[0]+2*g[0][0]+g[1][0])*e,(-.25*y[0][1]+.375*y[1][1]+n[1]+2*g[0][1]+g[1][1])*e,(-.25*y[0][2]+.375*y[1][2]+n[2]+2*g[0][2]+g[1][2])*e];return y[1]=y[0],y[0]=t,g[1]=g[0],g[0]=n,t}(n));var r,o,i,c,u,s,l,d,_,f,m,v,b,z,S,M,k=-e/2,C=-t/2;return r=[k,C,0],o=[k+e,C,0],i=[k,C+t,0],c=[n[0],n[1],n[2]],u=.1,s=p(h(o,r)),l=p(h(i,r)),d=p(function(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}(s,l)),_=h(r,c),f=h(o,c),m=h(i,c),v=-x(_,d),b=x(s,_)*u/v,z=x(s,f)*u/v,S=x(l,_)*u/v,M=x(l,m)*u/v,[[.2/(z-b),0,0,0,0,.2/(M-S),0,0,(z+b)/(z-b),(M+S)/(M-S),-10.1/9.9,-1,0,0,-2/9.9,0],[s[0],l[0],d[0],0,s[1],l[1],d[1],0,s[2],l[2],d[2],0,c[0],c[1],c[2],1]]}(v(n),I,I*e[1]/e[0]);E.rotation.setFromRotationMatrix(X.matrixWorld.clone().invert()),F.matrixWorld.fromArray(t[1]),F.matrixWorld.decompose(F.position,F.quaternion,F.scale),F.projectionMatrix.fromArray(t[0]),F.matrixWorldInverse.copy(F.matrixWorld).invert(),F.projectionMatrixInverse.copy(F.projectionMatrix).invert(),Z.render(G,F)}requestAnimationFrame(V)}))}E.rotation.set(A.Rotation.X,A.Rotation.Z,A.Rotation.Y),E.scale.set(A.Scale,A.Scale,A.Scale),E.position.set(A.Translation.X,A.Translation.Y,A.Translation.Z);var L=function(){return C(this,void 0,void 0,(function(){var n=this;return H(this,(function(e){return this.initialized||this.pending?[2,this.initialized]:(this.pending=!0,[2,u.S().then((function(){return n.pending=!1,n.initialized=!0,n.initialized}))])}))}))}.bind({initialized:!1,pending:!1});function Y(n){return C(this,void 0,void 0,(function(){return H(this,(function(e){return n?L().then((function(n){n&&(V=j,requestAnimationFrame(V))})):(V=q,requestAnimationFrame(V)),[2]}))}))}var Z,G,X,J={uniforms:{u_num_bands:{value:null},u_texture_sz:{value:null},u_block_sz:{value:null},u_block_dim:{value:null},u_data_0:{value:null},u_data_1:{value:null},u_data_2:{value:null},u_data_3:{value:null},u_data_4:{value:null},u_data_5:{value:null},u_data_6:{value:null},index_texture:{value:null},u_aabb_min:{value:null},u_aabb_max:{value:null},transformMatrix:{value:null}},vertexShader:"\n    precision highp float;\n    uniform mat4 transformMatrix;\n    out vec3 v_rd_world;\n    out vec3 v_ro_world;\n    void main() {\n        mat4 modifiedViewMatrix = viewMatrix * transformMatrix;\n        v_ro_world = inverse(modifiedViewMatrix)[3].xyz;\n        v_rd_world = (modelMatrix * vec4(position, 1.0)).xyz - v_ro_world;\n        gl_Position = projectionMatrix * modifiedViewMatrix * modelMatrix * vec4(position, 1.0);\n        // vec4 position_world = modelMatrix * vec4(position, 1.0);\n        // v_rd_world = position_world.xyz - cameraPosition;\n        // gl_Position = projectionMatrix * viewMatrix * position_world;\n    }",fragmentShader:"\n    precision highp float;\n    precision highp sampler3D;\n    precision highp isampler3D;\n    uniform vec3 u_aabb_min;\n    uniform vec3 u_aabb_max;\n    uniform ivec3 u_texture_sz;\n    uniform int u_block_sz;\n    uniform int u_block_dim;\n    uniform int u_num_bands;\n    uniform sampler3D u_data_0;\n    uniform sampler3D u_data_1;\n    uniform sampler3D u_data_2;\n    uniform sampler3D u_data_3;\n    uniform sampler3D u_data_4;\n    uniform sampler3D u_data_5;\n    uniform sampler3D u_data_6;\n    uniform isampler3D index_texture;\n    in vec3 v_rd_world;\n    in vec3 v_ro_world;\n\n    float SH_0_0( vec3 n ) { return  1.0; }\n    float SH_1_0( vec3 n ) { return  n.y; }\n    float SH_1_1( vec3 n ) { return  n.z; }\n    float SH_1_2( vec3 n ) { return  n.x; }\n    float SH_2_0( vec3 n ) { return  n.x*n.y; }\n    float SH_2_1( vec3 n ) { return  n.y*n.z; }\n    float SH_2_2( vec3 n ) { return  (3.0*n.z*n.z-1.0); }\n    float SH_2_3( vec3 n ) { return  n.x*n.z; }\n    float SH_2_4( vec3 n ) { return  (n.x*n.x-n.y*n.y); }\n    \n    float undiscretize_alpha(const float discretized_alpha)\n    {\n        const float e = exp(1.0f);\n        return 256.0f*(exp(discretized_alpha)-1.0f)/(e-1.0f);\n    }\n    \n    vec4 get_color(vec3 rd, vec3 global_tx, int index)\n    {\n        vec4 c = vec4(0.0);\n        // Compute tx  \n        ivec3 sparse_offset = ivec3(\n            index % u_texture_sz.x,\n            (index / u_texture_sz.x) % u_texture_sz.y,\n            index / (u_texture_sz.x * u_texture_sz.y)\n        ) * (u_block_sz + 2);\n    \n        vec3 local_offset = mod(global_tx * vec3(u_block_dim*u_block_sz), float(u_block_sz)) + vec3(1);\n        vec3 tx = (vec3(sparse_offset) + local_offset) / vec3((u_block_sz + 2) * u_texture_sz);\n        // ivec3 stp = ivec3(round(global_tx * vec3(u_block_sz * u_block_dim) - 0.5));\n        // ivec3 local_offset_i = (stp % u_block_sz) + ivec3(1);\n        // ivec3 itx = sparse_offset + local_offset_i;\n    \n        //    c0  c1   c2   c3   c4   c5   c6    \n        // |000a|1112|2233|3444|5556|6677|7888|\n        // | SH0|   SH1    |       SH2        |\n        // (0)\n        {\n            vec4 w0 = texture(u_data_0, tx);\n            // vec4 w0 = texelFetch(u_data_0, itx, 0);\n            float sh00 = SH_0_0(rd);\n            c.x = w0.x * sh00;\n            c.y = w0.y * sh00;\n            c.z = w0.z * sh00;\n            c.a = undiscretize_alpha(w0.w);\n        }\n        // (1-2)\n        if(u_num_bands >= 3)\n        {\n            vec4 w10_11 = texture(u_data_1, tx);\n            vec4 w11_12 = texture(u_data_2, tx);\n            vec4 w12_20 = texture(u_data_3, tx);\n            float sh10 = SH_1_0(rd);\n            float sh11 = SH_1_1(rd);\n            float sh12 = SH_1_2(rd);\n            c.x += w10_11.x * sh10;\n            c.y += w10_11.y * sh10;\n            c.z += w10_11.z * sh10;\n            c.x += w10_11.w * sh11;\n            //\n            c.y += w11_12.x * sh11;\n            c.z += w11_12.y * sh11;\n            c.x += w11_12.z * sh12;\n            c.y += w11_12.w * sh12;\n            //\n            c.z += w12_20.x * sh12;\n            if(u_num_bands >= 7)\n            {\n                float sh20 = SH_2_0(rd);\n                c.x += w12_20.y * sh20;\n                c.y += w12_20.z * sh20;\n                c.z += w12_20.w * sh20;\n            }\n        }\n        // (3-6)\n        if(u_num_bands >= 7)\n        {\n            vec4 w21_22 = texture(u_data_4, tx);\n            vec4 w22_23 = texture(u_data_5, tx);\n            vec4 w23_24 = texture(u_data_6, tx);\n            float sh21 = SH_2_1(rd);\n            float sh22 = SH_2_2(rd);\n            float sh23 = SH_2_3(rd);\n            float sh24 = SH_2_4(rd);\n    \n            c.x += w21_22.x * sh21;\n            c.y += w21_22.y * sh21;\n            c.z += w21_22.z * sh21;\n            c.x += w21_22.w * sh22;\n    \n            c.y += w22_23.x * sh22;\n            c.z += w22_23.y * sh22;\n            c.x += w22_23.z * sh23;\n            c.y += w22_23.w * sh23;\n    \n            c.z += w23_24.x * sh23;\n            c.x += w23_24.y * sh24;\n            c.y += w23_24.z * sh24;\n            c.z += w23_24.w * sh24;\n        }\n        return c;\n    }\n    \n    int get_index(vec3 tx)\n    {\n        ivec3 stp = ivec3(round(tx * vec3(u_block_dim) - 0.5));\n        return texelFetch(index_texture, stp, 0).x;\n        // return texture(index_texture, tx).x;\n    }\n    \n    float min_component(in vec3 v) {\n        return min(min(v.x, v.y), v.z);\n    }\n    \n    float max_component(in vec3  v) {\n        return max(max(v.x, v.y), v.z);\n    }\n    \n    // Intersect a ray with aabb where aabb.mix.xyz = -1, and aabb.max.xyz = 1.\n    // returns vec2(min_t, max_t).\n    vec2 boxIntersection(in vec3 ro, in vec3 rd) {\n        vec3 m = 1.0/rd;\n        vec3 n = ro*m;\n        vec3 t0 = -m - n;\n        vec3 t1 = m - n;\n        // isect if mint <= maxt;\n        return vec2(max_component(min(t0,t1)), min_component(max(t0,t1)));\n    }\n\n    vec2 aabbIntersection(in vec3 ro, in vec3 rd) {\n        vec3 m = 1.0/rd;\n        vec3 t0 = (u_aabb_min - ro)*m;\n        vec3 t1 = (u_aabb_max - ro)*m;\n        // isect if mint <= maxt;\n        return vec2(max_component(min(t0,t1)), min_component(max(t0,t1)));\n    }\n\n    vec3 to_texcoord(in vec3 pos)\n    {\n        return (pos - u_aabb_min)/(u_aabb_max - u_aabb_min);\n    }\n    \n    float hash(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }\n    const float E = 2.7182818284;\n    void main() {                        \n        vec3 rd = normalize(v_rd_world);\n        vec3 ro = v_ro_world;\n        vec2 ti = aabbIntersection(v_ro_world, rd);\n    \n        vec3 H = vec3(0.0);\n        float V_i = 0.0;\n        float grid_sz = float(u_block_sz * u_block_dim);\n        float dt = 2.0 / grid_sz;\n        for(float t = max(ti.x, 0.0); (t < ti.y); t+=dt)\n        {\n            vec3 pos = ro + t*rd; // pos.xyz is in range (-1, 1).\n            if(pos.x <= (u_aabb_min.x + 0.01) ||\n               pos.y <= (u_aabb_min.y + 0.01) || \n               pos.z <= (u_aabb_min.z + 0.01) || \n               pos.x >= (u_aabb_max.x - 0.01) || \n               pos.y >= (u_aabb_max.y - 0.01) || \n               pos.z >= (u_aabb_max.z - 0.01) )\n               continue;\n    \n            vec3 uv = to_texcoord(pos);\n    \n            int index = get_index(uv);\n            if (index < 0) continue;\n            vec4 c = get_color(-rd, uv, index);\n            // a = 256.0*(exp(a)-1.0)/(E-1.0); // uint8(255*log((e-1)*clamp(v,0,S)/S + 1)), S=256\n            // if(a > 1.0)\n    \n            if(c.a != -1.0)\n            {\n                float v = c.a*dt;\n                H += exp(-V_i) * (1.0 - exp(-v)) * c.rgb;\n                V_i += v;\n            }\n\n\n            if (exp(-V_i) < (grid_sz / 4480.0)) break;\n        }\n        // V_i = V_i*smoothstep(0.1, 1.0, V_i);\n        gl_FragColor.xyz = H;// + exp(-V_i) * vec3(0.0);\n        gl_FragColor.a = 1.0;\n    }\n    "};function K(){var n=document.getElementById("volume-canvas");return[n.clientWidth,n.clientHeight]}function O(n){var e=document.getElementById("volume-canvas");Z=new o.CP7({antialias:!1,canvas:e});var t=K();Z.setSize(t[0],t[1]),window.addEventListener("resize",Q),G=new o.xsS,(X=new o.cPb(60,t[0]/t[1],.01,5)).position.set(.5*A.Scale,.5*A.Scale,4.5*A.Scale),X.lookAt(0,0,0),(b=new i.z(X,Z.domElement)).maxPolarAngle=.51*Math.PI,b.minPolarAngle=.3*Math.PI,b.addEventListener("change",q),G.add(X);var a,r=document.getElementById("progress"),u=document.getElementById("progress_bar"),s=document.getElementById("progress_text"),l=document.getElementById("progress_header"),d=new o.hH6;d.setRequestHeader({"Cache-Control":"no-cache"});var _="/3d_models/"+n+"/";d.setResponseType("json").loadAsync(_+"runtime_info.json").then((function(n){a=n})).then((function(n){var e=["index.bin.tar.gz"].concat(Array.from({length:a.num_bands},(function(n,e){return"grid_"+e+".bin.tar.gz"})));d.setResponseType("arraybuffer");var t={loaded:Array(e.length),total:Array(e.length),progress:function(n){function e(n,e){return n+e}this.loaded[this.i]=n.loaded,this.total[this.i]=n.total;var t=this.total.reduce(e),a=this.loaded.reduce(e)/t;s.innerHTML=Math.round(100*a)+"%",u.value=100*a},onProgress_i:function(n){return t.progress.bind({loaded:t.loaded,total:t.total,i:n})}};return Promise.all(e.map((function(n,e){return d.loadAsync(_+n,t.onProgress_i(e))})))})).then((function(n){return console.log("download done"),l.innerHTML="Unpacking",s.innerHTML="This may take a while...",new Promise((function(e,t){setTimeout((function(){e(n.map((function(n){return c.ec(new Uint8Array(n))})))}),300)}))})).then((function(n){return console.log("unpacking"),l.innerHTML="Reading data",s.innerHTML="...",Promise.all(n.map((function(n){return P(n.buffer)})))})).then((function(n){console.log("untar");var e=n.map((function(n){return n[0].buffer})),t=new Int32Array(e[0]),i=e.slice(1).map((function(n){return new Uint8Array(n)})),c=o.rDY.clone(J.uniforms);S=a.grid_half_side;var u=a.grid_offset.map((function(n,e){return n-S[e]})),s=a.grid_offset.map((function(n,e){return n+S[e]}));c.u_aabb_min.value=u,c.u_aabb_max.value=s,c.u_block_sz.value=a.block_sz,c.u_block_dim.value=a.block_dim;var l,d,_,f,m,v,h=(l=t,_=d=a.block_dim,f=d,m=d,(v=new o.JUT(l,_,f,m)).internalFormat="R32I",v.format=o.D9w,v.type=o.Kz5,v.magFilter=o.TyD,v.minFilter=o.TyD,v.wrapR=o.uWy,v.wrapS=o.uWy,v.wrapT=o.uWy,v.needsUpdate=!0,v.generateMipmaps=!1,v);c.index_texture.value=h;var x=function(n,e){var t=e+2,a=n.length/4/Math.pow(t,3),r=Math.floor(2048/t),o=Math.floor(Math.pow(a,1/3)),i=[o+1,o+1,o+1];function c(n){return n[0]*n[1]*n[2]}for(var u=1;u<=r;u++)for(var s=u;s<=r;s++)for(var l=Math.max(Math.max(u,s),o);l<=r;l++){var d=[u,s,l];if(c(d)>=c(i))break;c(d)>=a&&(i=d)}return i}(i[0],a.block_sz);c.u_texture_sz.value=x,console.log("3D texture size: "+x),c.u_num_bands.value=a.num_bands,i.forEach((function(n,e){var t=function(n,e,t){for(var a=t+2,r=new Uint8Array(e[0]*a*(e[1]*a)*(e[2]*a)*4).fill(0),i=0,c=0;c<e[2];c++)for(var u=0;u<e[1];u++)for(var s=0;s<e[0];s++)for(var l=0;l<a;l++)for(var d=0;d<a;d++)for(var _=0;_<a;_++)for(var f=a*s+_,m=a*u+d,v=(a*c+l)*a*e[0]*a*e[1]+m*a*e[0]+f,h=0;h<4;h++)i<n.length&&(r[4*v+h]=n[i],i++);var x=a*e[0],p=a*e[1],w=a*e[2],g=new o.JUT(r,x,p,w);return g.format=o.wk1,g.type=o.ywz,g.magFilter=o.wem,g.minFilter=o.wem,g.wrapR=o.uWy,g.wrapS=o.uWy,g.wrapT=o.uWy,g.needsUpdate=!0,g.generateMipmaps=!1,g}(n,x,a.block_sz);c["u_data_"+e].value=t})),c.transformMatrix.value=(new o.yGw).identity();var p=new o.jyz({uniforms:c,vertexShader:J.vertexShader,fragmentShader:J.fragmentShader,side:o._Li}),w=new o.DvJ(2,2,2);(z=new o.Kj0(w,p)).scale.fromArray(S),z.onBeforeRender=function(n,e,t,a,r,o){r.uniforms.transformMatrix.value.copy(E.matrix)},r.style.display="none",G.add(z),G.add(E),Y(A["Use headtracking"]),console.log("Loading done!")})).catch(console.log)}function Q(){var n=K();X.aspect=n[0]/n[1],X.updateProjectionMatrix(),Z.setSize(n[0],n[1])}},2694:(n,e,t)=>{t.d(e,{Dd:()=>y,S1:()=>b,rr:()=>p}),t(9059);var a=t(3224),r=t(999),o=t(7155),i=t(3644),c=t(8734);const u=!1;let s,l,d,_,f,m=0,v=0,h=0;const x={stats:d,beginStats:function(){},endStats:function(){}},p={onChanged:function(n){},onCameraChanged:function(n){},onGUIConstructed:function(n){}};function w(){_=(performance||Date).now()}function g(){const n=(performance||Date).now();if(v+=n-_,++m,n-h>=1e3){const e=v/m;v=0,m=0,d.customFpsPanel.update(1e3/e,120),h=n}}async function y(n=!0){let e=null;return await async function(){if((o.ed.isTargetFPSChanged||o.ed.isSizeOptionChanged)&&(l=await a.V.setupCamera(o.ed.camera),o.ed.isTargetFPSChanged=!1,o.ed.isSizeOptionChanged=!1,p.onCameraChanged(l)),o.ed.isModelChanged||o.ed.isFlagChanged||o.ed.isBackendChanged){o.ed.isModelChanged=!0,window.cancelAnimationFrame(f),null!=s&&s.dispose(),(o.ed.isFlagChanged||o.ed.isBackendChanged)&&await(0,c.Qt)(o.ed.flags,o.ed.backend);try{s=await(0,o.cH)(o.ed.model)}catch(n){s=null,alert(n)}o.ed.isFlagChanged=!1,o.ed.isBackendChanged=!1,o.ed.isModelChanged=!1}}(),o.ed.isModelChanged||(e=async function(n){l.video.readyState<2&&await new Promise((n=>{l.video.onloadeddata=()=>{n()}}));let e=null;if(null!=s){u&&w();try{e=await s.estimateFaces(l.video,{flipHorizontal:!1}),p.onChanged(e)}catch(n){s.dispose(),s=null,alert(n)}u&&g()}return n&&(document.querySelector(".camera-canvas-wrapper").style.display="block",l.drawCtx(),e&&e.length>0&&!o.ed.isModelChanged&&l.drawResults(e,o.ed.modelConfig.triangulateMesh,o.ed.modelConfig.boundingBox)),e}(n)),e}async function b(){const n=new URLSearchParams(window.location.search),e=await(0,r.j)(n);p.onGUIConstructed(e),d=(0,i.t)(),x.stats=d,x.beginStats=w,x.endStats=g,l=await a.V.setupCamera(o.ed.camera),p.onCameraChanged(l),await(0,c.Qt)(o.ed.flags,o.ed.backend),s=await(0,o.cH)(),console.log("face detector created")}}}]);